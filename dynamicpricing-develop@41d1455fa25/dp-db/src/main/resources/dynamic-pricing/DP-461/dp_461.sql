
SELECT ID from `RA_TNT_APPS` WHERE `NAME` = 'DPA' INTO @APP_ID;

SET @CREATED_BY = 'SYSTEM';

SET @CREATED_ON =  UNIX_TIMESTAMP() * 1000;

INSERT INTO `RA_TNT_APP_PARAMS` (`ID`, `RA_TNT_APP_ID`, `ATTR_KEY`, `ATTR_VALUE`, `CLASSIFICATION`, `CREATED_BY`, `CREATED_ON`, `LAST_UPDATED_BY`, `LAST_UPDATED_ON`) 
VALUES (UUID(), @APP_ID, 'hubzu.daily.qa.report.all.rows', 'SELECT OT1.SELR_PROP_ID_VC_NN,OT1.RBID_PROP_ID_VC_PK,t1.RBID_PROP_ID_VC_FK,OT1.REO_PROP_STTS_VC ,OT1.PROP_SOLD_DATE_DT,OT1.PROP_STTS_ID_VC_FK,T1.RBID_PROP_ID_VC_FK,T1.RBID_PROP_LIST_ID_VC_PK,T1.LIST_TYPE_ID_VC_FK,T1.LIST_PRCE_NT,T1.LIST_STRT_DATE_DT_NN,T1.LIST_END_DATE_DT_NN,T1.LIST_STTS_DTLS_VC,T1.OCCPNCY_STTS_AT_LST_CREATN FROM RRRBPMTX_PROP_LIST T1, RRRBPMMS_PROP OT1 WHERE T1.RBID_PROP_ID_VC_FK  IN (:idList) AND T1.RBID_PROP_ID_VC_FK = OT1.RBID_PROP_ID_VC_PK AND T1.LIST_TYPE_ID_VC_FK = \'AUCN\' AND T1.OCCPNCY_STTS_AT_LST_CREATN <> \'Y\' AND (T1.LIST_STTS_DTLS_VC NOT IN (\'CANCELLED\',\'DISAPPROVED\') OR T1.LIST_STTS_DTLS_VC IS NULL) AND OT1.SELR_ACNT_ID_VC_FK IN (\'000\',\'900\',\'891\') AND OT1.PROP_SOLD_DATE_DT IS NULL AND (SELECT COUNT(*) FROM RRRBPMMS_PROP OT2 WHERE OT2.SELR_PROP_ID_VC_NN = OT1.SELR_PROP_ID_VC_NN AND OT1.PROP_SOLD_DATE_DT IS NULL AND OT2.PROP_SOLD_DATE_DT IS NOT NULL)=0 ORDER BY OT1.SELR_PROP_ID_VC_NN DESC, TO_DATE(LIST_STRT_DATE_DT_NN) DESC, T1.LIST_END_DATE_DT_NN DESC', NULL, @CREATED_BY, @CREATED_ON, @CREATED_BY, @CREATED_ON);

INSERT INTO `RA_TNT_APP_PARAMS` (`ID`, `RA_TNT_APP_ID`, `ATTR_KEY`, `ATTR_VALUE`, `CLASSIFICATION`, `CREATED_BY`, `CREATED_ON`, `LAST_UPDATED_BY`, `LAST_UPDATED_ON`) 
VALUES (UUID(), @APP_ID, 'hubzu.daily.qa.report', 'SELECT t1.SELR_PROP_ID_VC_NN, t1.RBID_PROP_ID_VC_PK, t2.RBID_PROP_ID_VC_FK, t1.REO_PROP_STTS_VC , t1.PROP_SOLD_DATE_DT, t1.PROP_STTS_ID_VC_FK, t2.RBID_PROP_ID_VC_FK, t2.RBID_PROP_LIST_ID_VC_PK, t2.LIST_TYPE_ID_VC_FK, t2.LIST_PRCE_NT, t2.LIST_STRT_DATE_DT_NN, t2.LIST_END_DATE_DT_NN, t2.LIST_STTS_DTLS_VC, t2.OCCPNCY_STTS_AT_LST_CREATN FROM RRRBPMMS_PROP t1 JOIN RRRBPMTX_PROP_LIST t2 ON t1.RBID_PROP_ID_VC_PK = t2.RBID_PROP_ID_VC_FK JOIN (SELECT t3.RBID_PROP_ID_VC_FK, MAX(TO_DATE(t3.LIST_STRT_DATE_DT_NN)) as LIST_STRT_DATE_DT_NN FROM RRRBPMTX_PROP_LIST t3 WHERE TO_DATE(t3.LIST_STRT_DATE_DT_NN) BETWEEN TO_DATE(?) AND TO_DATE(?) AND t3.LIST_STTS_DTLS_VC NOT IN (\'CANCELLED\',\'DISAPPROVED\') GROUP BY t3.RBID_PROP_ID_VC_FK) t4 ON t2.RBID_PROP_ID_VC_FK = t4.RBID_PROP_ID_VC_FK AND TO_TIMESTAMP(t2.LIST_STRT_DATE_DT_NN, \'DD-Mon-RR\') = TO_TIMESTAMP(t4.LIST_STRT_DATE_DT_NN, \'DD-Mon-RR\') WHERE TO_DATE(t2.LIST_STRT_DATE_DT_NN) BETWEEN TO_DATE(?) AND TO_DATE(?) AND t2.LIST_STTS_DTLS_VC NOT IN (\'CANCELLED\',\'DISAPPROVED\') AND t2.OCCPNCY_STTS_AT_LST_CREATN <> \'Y\'', NULL, @CREATED_BY, @CREATED_ON, @CREATED_BY, @CREATED_ON);
